<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Character Creator</title>
  <style>
    @font-face {
      font-family: 'Skip Std B';
      src: url('./fonts/FOT-Skip Std B.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: sans-serif;
      margin: 15px;
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      height: 100vh;
      background: #0EB0F5;
    }

    #characterContainer {
      position: relative;
      width: 228px;
      height: 228px;
      flex-shrink: 0;
    }

    #background {
      position: absolute;
      top: 160%;
      left: 215%;
      transform: translate(50%, 50%) scale(3.50);
      width: 100%;
      z-index: 0;
    }

    #character {
      position: absolute;
      top: 57%;
      left: 180%;
      width: 100%;
      z-index: 1;
      transform: scale(0.988);
      transform-origin: top left;
      transition: transform 0.2s, top 0.2s, left 0.2s;
    }

    #character img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
    }

    .leftPanel {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-right: 30px;
      min-width: 167px;
    }

    .characterDropdownContainer {
      margin-bottom: 23px;
      width: 152px;
    }

    .characterDropdownContainer label {
      color: #fff;
      font-weight: bold;
      margin-bottom: 4.5px;
      display: block;
    }

    .characterDropdown {
      width: 100%;
      font-size: 12px;
      padding: 3.8px 6px;
      border-radius: 4.5px;
      border: 1px solid #aaa;
      font-family: sans-serif;
      margin-bottom: 7.6px;
    }

    .optionsPanel {
      display: none;
      flex-direction: column;
      width: 152px;
    }

    .optionsPanel.active {
      display: flex;
    }

    .optionsGroup {
      margin-bottom: 13.7px;
    }

    .optionsLabel {
      color: #fff;
      font-weight: bold;
      margin-bottom: 4.5px;
      display: block;
    }

    .options {
      display: flex;
      flex-direction: row;
      gap: 7.6px;
      margin: 0;
    }

    .options img {
      width: 68px;
      height: 68px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 6px;
      background: #fff;
    }

    .options img.selected {
      border-color: #007BFF;
    }

    #overlayText, #overlayName {
      position: absolute;
      pointer-events: none;
      font-family: 'Skip Std B', sans-serif;
      user-select: none;
    }

    #overlayText {
      top: 377px;
      left: 293%;
      width: 100%;
      text-align: left;
      font-size: 16.7px;
      font-weight: bold;
      font-stretch: ultra-expanded;
      color: #fff;
      z-index: 2;
      padding-left: 7.6px;
      transform: scaleY(1.1);
      transform-origin: top;
    }

    #overlayName {
      top: 349px;
      left: 273%;
      width: 100%;
      text-align: left;
      font-size: 11.7px;
      font-weight: bold;
      color: #0CF0F4;
      z-index: 3;
      padding-left: 3.8px;
    }

    #nameInputContainer {
      top: 530px;
      left: 141%;
      width: 350px;
      position: absolute;
      height: 80px;
    }

    #nameInput {
      width: 350px;
      height: 60px;
      font-size: 18px;
      padding: 10px;
      box-sizing: border-box;
      border-radius: 5px;
    }

    #downloadBtn {
      margin-top: 20px;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      background: #007BFF;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    #downloadBtn:hover {
      background: #0056b3;
    }

    #backgroundText, #backgroundTextLine2, #backgroundTextLine3 {
      position: absolute;
      left: 10px;
      color: #fff;
      font-weight: bold;
      font-family: 'Skip Std B', sans-serif;
      z-index: 1;
    }

    #backgroundText a, #backgroundTextLine2 a, #backgroundTextLine3 a {
      color: #fff;
      text-decoration: underline;
      text-decoration-color: #030303;
      text-decoration-thickness: 2px;
      cursor: pointer;
    }

    #backgroundText { top: 500px; font-size: 16px; }
    #backgroundTextLine2 { top: 522px; font-size: 12px; }
    #backgroundTextLine3 { top: 539px; font-size: 12px; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body>
  <div class="leftPanel">
    <div class="characterDropdownContainer">
      <label for="characterDropdown">Choose Character:</label>
      <select id="characterDropdown" class="characterDropdown">
        <option value="" disabled selected>Select...</option>
        <option value="Aigis">Aigis</option>
        <option value="Junpei">Junpei</option>
        <!-- Add other characters as needed -->
      </select>
    </div>

    <div class="optionsPanel" id="optionsPanel">
      <div class="optionsGroup">
        <span class="optionsLabel">Choose Base</span>
        <div class="options" id="baseOptions"></div>
      </div>
      <div class="optionsGroup">
        <span class="optionsLabel">Choose Eyes</span>
        <div class="options" id="eyesOptions"></div>
      </div>
      <div class="optionsGroup">
        <span class="optionsLabel">Choose Mouth</span>
        <div class="options" id="mouthOptions"></div>
      </div>
    </div>

    <button id="downloadBtn">Download PNG</button>
  </div>

  <div id="characterContainer">
    <img id="background" src="./assets/p3rui.png">
    <div id="overlayName"></div>
    <div id="overlayText"></div>
    <div id="character">
      <img id="base" src="./assets/aigis/base1.png">
      <img id="eyes" src="./assets/aigis/eyes1.png">
      <img id="mouth" src="./assets/aigis/mouth1.png">
    </div>

    <div id="nameInputContainer">
      <label for="nameInput" style="color:#fff;font-weight:bold;">Dialogue:</label>
      <input type="text" id="nameInput" maxlength="100" placeholder="Your fate is in the cards...">
    </div>
  </div>

  <div id="backgroundText">
    <a href="https://github.com/kefnatyll" target="_blank">Code</a> made by kefnatyl.
  </div>
  <div id="backgroundTextLine2">
    Inspired by <a href="http://www.p5generator.com/" target="_blank">p5generator.com</a>.
  </div>
  <div id="backgroundTextLine3">
    All artwork by <a href="https://x.com/Atlus_West" target="_blank">Atlus</a>.
  </div>

  <script>
    const characterTransforms = {
      Aigis: { scale: 1.034, top: "82%", left: "150%" },
      Junpei: { scale: 1.178, top: "87%", left: "141%" }
    };

    function applyCharacterTransform(character) {
      const charDiv = document.getElementById("character");
      if (characterTransforms[character]) {
        const t = characterTransforms[character];
        charDiv.style.transform = `scale(${t.scale})`;
        charDiv.style.top = t.top;
        charDiv.style.left = t.left;
      } else {
        charDiv.style.transform = "scale(0.988)";
        charDiv.style.top = "57%";
        charDiv.style.left = "180%";
      }
    }

    const characterAssets = {
      Aigis: {
        base: ["assets/aigis/base1.png","assets/aigis/base2.png"],
        eyes: ["assets/aigis/eyes1.png","assets/aigis/eyes2.png"],
        mouth: ["assets/aigis/mouth1.png","assets/aigis/mouth2.png"]
      },
      Junpei: {
        base: ["assets/junpei/base1.png","assets/junpei/base2.png"],
        eyes: ["assets/junpei/eyes1.png","assets/junpei/eyes2.png"],
        mouth: ["assets/junpei/mouth1.png","assets/junpei/mouth2.png"]
      }
    };

    function setupOptions(containerId, targetId) {
      const container = document.getElementById(containerId);
      const imgs = container.querySelectorAll("img");
      const target = document.getElementById(targetId);
      imgs.forEach(img => {
        img.addEventListener("click", () => {
          target.src = img.src;
          imgs.forEach(i => i.classList.remove("selected"));
          img.classList.add("selected");
        });
      });
      if (imgs.length) imgs[0].classList.add("selected");
    }

    function populateOptions(character) {
      const baseOptions = document.getElementById("baseOptions");
      const eyesOptions = document.getElementById("eyesOptions");
      const mouthOptions = document.getElementById("mouthOptions");
      baseOptions.innerHTML = "";
      eyesOptions.innerHTML = "";
      mouthOptions.innerHTML = "";
      if (!characterAssets[character]) return;

      ["base","eyes","mouth"].forEach(type => {
        characterAssets[character][type].forEach((src, i) => {
          const img = document.createElement("img");
          img.src = src;
          if (i === 0) img.classList.add("selected");
          document.getElementById(type+"Options").appendChild(img);
        });
      });

      document.getElementById("base").src = characterAssets[character].base[0];
      document.getElementById("eyes").src = characterAssets[character].eyes[0];
      document.getElementById("mouth").src = characterAssets[character].mouth[0];

      setupOptions("baseOptions","base");
      setupOptions("eyesOptions","eyes");
      setupOptions("mouthOptions","mouth");
    }

    const characterDropdown = document.getElementById("characterDropdown");
    const optionsPanel = document.getElementById("optionsPanel");
    const overlayName = document.getElementById('overlayName');

    characterDropdown.addEventListener("change", function() {
      const character = this.value;
      if (character) {
        optionsPanel.classList.add("active");
        populateOptions(character);
        overlayName.textContent = character;
        applyCharacterTransform(character);
      }
    });

    const nameInput = document.getElementById('nameInput');
    const overlayText = document.getElementById('overlayText');
    nameInput.addEventListener('input', () => overlayText.textContent = nameInput.value);

    // Download PNG
    document.getElementById("downloadBtn").addEventListener("click", async () => {
      const container = document.getElementById("characterContainer");
      const canvas = await html2canvas(container, { useCORS: true, backgroundColor: null });
      const link = document.createElement("a");
      link.download = "character.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
